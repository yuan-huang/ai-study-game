# 🎮 游戏MCP服务器 v2.0 - 快速开始指南

## 🌟 新版本亮点

### ✨ v2.0 重大更新
- **🎭 Gemini TTS集成**: 使用Gemini 2.5 Flash Preview TTS进行对话音效
- **🔧 简化配置**: 统一使用GEMINI_API_KEY，无需配置Google Cloud
- **🎯 角色化语音**: 9种预设游戏角色，智能语音配置
- **🌍 多语言支持**: 中文、英文、日文、韩文
- **⚡ 即插即用**: 设置API密钥后立即可用

## 🚀 30秒快速启动

### 1. 运行自动安装 (推荐)
```bash
# 双击运行
install.bat

# 或命令行运行
.\install.bat
```

安装脚本会自动：
- ✅ 检查Node.js环境
- ✅ 安装所有依赖包
- ✅ 配置Gemini API密钥
- ✅ 编译TypeScript项目
- ✅ 创建必要目录
- ✅ 测试API连接

### 2. 启动服务器
```bash
npm start
```

## 🎯 核心功能概览

### 🖼️ 图片生成
```javascript
// 生成游戏角色
{
  "tool": "generate_game_image",
  "arguments": {
    "prompt": "一个勇敢的战士站在城堡前",
    "style": "pixel_art",
    "size": "512x512"
  }
}
```

### 🎭 对话音效 (Gemini TTS) ⭐ 新功能
```javascript
// NPC对话配音
{
  "tool": "generate_dialogue_audio",
  "arguments": {
    "text": "欢迎来到我的店铺！需要什么武器吗？",
    "character": "merchant",     // 角色：商人
    "emotion": "happy",          // 情感：快乐
    "language": "zh-CN",         // 语言：中文
    "speed": 1.0,               // 语速：正常
    "pitch": 0                  // 音调：标准
  }
}
```

**支持的角色**：warrior(战士), mage(法师), merchant(商人), princess(公主), villain(反派), narrator(旁白)等

### 🎼 背景音乐
```javascript
// 生成史诗主题音乐
{
  "tool": "generate_game_music",
  "arguments": {
    "prompt": "史诗般的冒险主题，展现英雄的旅程",
    "musicType": "theme",
    "genre": "orchestral",
    "mood": "epic",
    "duration": 60,
    "isLooping": true
  }
}
```

### 📊 数据库操作
```javascript
// 保存玩家数据
{
  "tool": "mongodb_insert",
  "arguments": {
    "collection": "players",
    "data": {
      "name": "英雄001",
      "level": 15,
      "class": "warrior"
    }
  }
}
```

## 🎭 Gemini TTS 特色功能

### 角色化语音配置
每个角色都有独特的声音特征：

| 角色 | 描述 | 推荐使用场景 |
|------|------|-------------|
| `warrior` | 雄浑有力，充满战斗精神 | 战斗呐喊、英雄宣言 |
| `mage` | 神秘优雅，带有魔法韵味 | 咒语念诵、智慧对话 |
| `merchant` | 热情诚恳，富有亲和力 | 商店交易、友好问候 |
| `princess` | 优雅温柔，气质非凡 | 剧情对话、感谢话语 |
| `villain` | 阴险狡诈，令人胆寒 | 反派威胁、邪恶计划 |
| `narrator` | 平静客观，专业清晰 | 系统提示、故事叙述 |

### 多语言支持
- **中文 (zh-CN)**: 标准普通话，多种音色
- **英文 (en-US)**: 美式发音，适合国际化
- **日文 (ja-JP)**: 标准日语发音
- **韩文 (ko-KR)**: 标准韩语发音

### 高级控制参数
- **语速控制**: 0.25x - 4.0x (适应不同场景节奏)
- **音调调节**: -20 到 +20 半音 (创造独特声音)
- **情感表达**: 8种情感状态 (neutral, happy, angry, sad, excited, calm, serious, heroic)

## 🧪 测试功能

### 快速测试Gemini TTS
```bash
# 运行专门的TTS测试
.\test-gemini-tts.bat
```

测试将执行：
- ✅ 商人角色快乐对话
- ✅ 战士角色愤怒呐喊  
- ✅ 英文英雄宣言
- ✅ 音频文件生成

## 📁 项目结构

```
mcp-server/
├── src/                        # 源代码
│   ├── index.ts               # 主服务器
│   └── services/
│       ├── imageGeneration.ts     # 图片生成
│       ├── gameDialogueService.ts # 对话音效 (Gemini TTS)
│       ├── gameMusicService.ts    # 背景音乐
│       └── mongodbService.ts      # 数据库
├── generated_audio/           # 生成的音频文件
├── generated_music/          # 生成的音乐文件
├── examples/                 # 使用示例
├── .env                     # 环境配置
└── README.md               # 详细文档
```

## ⚙️ 环境配置

### .env 文件示例
```env
# Gemini API密钥 (图片生成 + 对话音效)
GEMINI_API_KEY=your_gemini_api_key_here

# MongoDB数据库连接
MONGODB_URI=mongodb://localhost:27017/swl

# Lyria音乐生成API (可选，未来功能)
# LYRIA_API_KEY=your_lyria_api_key
```

### 获取Gemini API密钥
1. 访问 [Google AI Studio](https://makersuite.google.com/app/apikey)
2. 登录Google账号
3. 创建新的API密钥
4. 复制密钥到.env文件

## 🎯 实用示例

### 创建完整的NPC
```javascript
// 1. 生成NPC形象
{
  "tool": "generate_game_image",
  "arguments": {
    "prompt": "友善的老铁匠，穿着皮革围裙",
    "style": "realistic"
  }
}

// 2. 录制NPC对话
{
  "tool": "generate_dialogue_audio", 
  "arguments": {
    "text": "欢迎！我是这里最好的铁匠，需要修理装备吗？",
    "character": "merchant",
    "emotion": "happy",
    "language": "zh-CN"
  }
}

// 3. 保存NPC数据
{
  "tool": "mongodb_insert",
  "arguments": {
    "collection": "npcs",
    "data": {
      "name": "铁匠汤姆",
      "type": "blacksmith",
      "dialogue": ["欢迎！我是这里最好的铁匠，需要修理装备吗？"],
      "voiceConfig": {
        "character": "merchant",
        "emotion": "happy"
      }
    }
  }
}
```

### 多语言角色对话
```javascript
// 中文女法师
{
  "tool": "generate_dialogue_audio",
  "arguments": {
    "text": "古老的魔法即将苏醒，感受力量的召唤吧！",
    "character": "mage",
    "emotion": "calm",
    "language": "zh-CN",
    "gender": "female",
    "speed": 0.9,
    "pitch": -2
  }
}

// 英文男战士
{
  "tool": "generate_dialogue_audio", 
  "arguments": {
    "text": "For honor and glory! We shall not surrender!",
    "character": "warrior",
    "emotion": "heroic", 
    "language": "en-US",
    "gender": "male",
    "speed": 1.2,
    "pitch": 3
  }
}

// 日文公主
{
  "tool": "generate_dialogue_audio",
  "arguments": {
    "text": "ありがとうございます、勇者様。",
    "character": "princess",
    "emotion": "happy",
    "language": "ja-JP",
    "gender": "female"
  }
}
```

## 🔧 常见问题

### Q: API密钥错误怎么办？
**A**: 检查以下步骤：
1. 确认.env文件中GEMINI_API_KEY设置正确
2. 验证API密钥是否有效（访问Google AI Studio）
3. 确认网络连接正常

### Q: MongoDB连接失败？
**A**: 确保MongoDB服务正在运行：
```bash
# Windows
net start MongoDB

# 或直接启动MongoDB服务
mongod
```

### Q: 音频文件在哪里？
**A**: 生成的音频文件保存在 `./generated_audio/` 目录中。当前为模拟生成模式，实际集成需要等待Gemini TTS API正式发布。

### Q: 如何切换为实际的TTS API？
**A**: 当Gemini TTS API正式发布后，修改 `gameDialogueService.ts` 中的 `generateAudioWithGemini` 方法，根据官方API文档调整请求格式。

## 🚀 进阶使用

### 自定义角色声音
```javascript
// 创建自定义角色配置
{
  "tool": "generate_dialogue_audio",
  "arguments": {
    "text": "这是自定义的角色声音",
    "character": "default",     // 使用默认角色
    "emotion": "neutral",
    "language": "zh-CN", 
    "gender": "male",          // 手动指定性别
    "speed": 0.8,             // 慢速
    "pitch": -5               // 低音调
  }
}
```

### 批量生成对话
对于大量对话，建议：
1. 准备对话列表
2. 使用脚本批量调用MCP工具
3. 统一管理音频文件命名

### 性能优化建议
- 🔄 启用音频文件缓存
- 📁 定期清理临时文件
- ⚡ 使用MongoDB索引优化查询
- 🎯 根据游戏需要调整音频质量参数

## 📚 更多资源

- 📖 [完整技术文档](README.md)
- 💡 [使用示例集合](examples/usage-examples.json)
- 🔗 [Gemini AI官方文档](https://ai.google.dev/)
- 🎮 [MCP协议规范](https://modelcontextprotocol.io/)

---

🎉 **祝你游戏开发愉快！使用Gemini AI的力量，为你的游戏角色注入生命力！** 