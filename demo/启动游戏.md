# 🎮 智慧塔防游戏 - 启动指南 (完整版 + AI功能)

## 🤖 新功能：AI个性化题目生成

本游戏现已集成 **Google Gemini AI**，能根据您选择的年级、科目和学习内容，实时生成个性化题目！

## 🚀 完整启动步骤

### 第一步：启动 Gemini AI 服务器（新增功能）

**推荐方式：**
1. 双击运行 `start_gemini_server.bat`
2. 等待看到 "服务器启动成功" 提示
3. 保持此窗口开启（不要关闭）

**手动方式：**
```bash
# 安装依赖
pip install flask flask-cors requests

# 启动AI服务器
python gemini_server.py
```

**验证AI服务器：**
- 浏览器访问：http://localhost:5000/health
- 看到 `{"status": "ok"}` 表示成功

### 第二步：启动游戏服务器

**方法一：conda + Python命令行（推荐）**
1. 打开新的命令提示符或PowerShell（不要关闭AI服务器窗口）
2. 激活conda base环境：`conda activate base`
3. 进入游戏目录：`cd demo`  
4. 启动服务器：`python -m http.server 8000`
5. 打开浏览器访问：`http://localhost:8000`

**方法二：双击批处理文件**
双击 `start_server.bat` 文件，会自动激活conda base环境并启动服务器

**方法三：PowerShell脚本**
1. 右键点击 `start_server.ps1`
2. 选择"使用PowerShell运行"

**方法四：直接运行Python脚本**
1. 激活conda环境：`conda activate base`
2. 运行：`python server.py`

### 第三步：开始游戏

访问 http://localhost:8000，享受AI驱动的个性化学习体验！

## ⭐ AI功能体验

### 1. 选择学习配置
- **年级**：1-6年级（难度自动适配）
- **科目**：数学、语文、英语
- **自定义内容**：输入您想重点学习的内容

### 2. AI生成过程
- 实时显示AI准备进度
- 自动调用Gemini API
- 生成8道个性化题目

### 3. 智能容错
- AI服务不可用时自动降级到本地题目
- 确保游戏体验不受影响

## 🌐 访问地址

- **游戏主页**：http://localhost:8000
- **AI服务器**：http://localhost:5000
- **健康检查**：http://localhost:5000/health

## 📁 文件说明

### 游戏核心文件
- `index.html` - 游戏主页面
- `game.js` - 游戏逻辑代码（支持AI题目生成）
- `style.css` - 游戏样式
- `server.py` - 游戏服务器

### AI功能文件（新增）
- `gemini_server.py` - Gemini AI题目生成服务器
- `start_gemini_server.bat` - AI服务器启动脚本
- `Gemini_API使用说明.md` - AI功能详细说明

### 启动脚本
- `start_server.bat` - Windows批处理启动脚本（conda版本）
- `start_server.ps1` - PowerShell启动脚本
- `start_server_conda.bat` - 专用conda启动脚本

## 🐍 Conda环境说明

- 所有启动脚本都会自动激活conda base环境
- 确保已安装Anaconda或Miniconda
- 如果需要使用其他conda环境，请修改脚本中的环境名称

## ⚠️ 故障排除

### AI功能相关问题

**1. AI服务器启动失败**
```bash
# 检查Python环境
python --version

# 重新安装依赖
pip install --upgrade flask flask-cors requests
```

**2. 无法连接AI服务器**
- 确保5000端口未被占用
- 检查防火墙设置
- 验证 http://localhost:5000/health 是否可访问

**3. Gemini API调用失败**
- 检查网络连接
- 查看AI服务器控制台错误信息
- 系统会自动降级到本地题目

### 游戏服务器问题

**4. 8000端口被占用**
```bash
# 使用其他端口
python -m http.server 8080
# 然后访问 http://localhost:8080
```

**5. conda环境问题**
```bash
# 重新激活环境
conda deactivate
conda activate base
```

## 🎯 最佳实践

### 启动顺序（重要）
1. **先启动** AI服务器（端口5000）
2. **再启动** 游戏服务器（端口8000）
3. **最后访问** 游戏页面

### 关闭顺序
1. 关闭浏览器
2. 按 Ctrl+C 停止游戏服务器
3. 按 Ctrl+C 停止AI服务器

## 🎮 游戏特色功能

### 塔防玩法
- **4种防御塔**：箭塔、炮塔、冰塔、魔法塔
- **塔拖拽**：可以拖拽塔到新位置
- **塔升级**：右键点击塔进行升级
- **5波敌人**：难度递增的挑战

### 学习系统
- **AI题目**：根据配置实时生成
- **积分奖励**：答对题目获得积分建塔
- **连击系统**：连续答对获得额外奖励
- **时间奖励**：快速答题获得时间奖励

## 🎓 教育价值

- **个性化学习**：AI根据年级和科目定制题目
- **游戏化学习**：寓教于乐，提高学习兴趣
- **即时反馈**：答题结果实时显示
- **进度跟踪**：记录学习成果和连击记录

---

## 🆘 需要帮助？

1. **查看详细文档**：`Gemini_API使用说明.md`
2. **检查控制台**：查看浏览器开发者工具的控制台信息
3. **验证服务**：确保两个服务器都正常运行
4. **重启服务**：关闭所有服务重新按顺序启动

享受AI驱动的个性化塔防学习体验！🎯🤖✨ 